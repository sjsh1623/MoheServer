# =====================================================================================
# Mohe 플랫폼 - 환경 변수 설정 (Control Panel)
# =====================================================================================
# 이 파일은 애플리케이션의 모든 설정을 중앙에서 관리합니다.
#
# 사용법:
#   1. 이 파일을 .env 파일로 복사: cp .env.example .env
#   2. 실제 값으로 수정
#   3. .env 파일은 .gitignore에 포함되어 있어 Git에 커밋되지 않습니다
#
# ⚠️ 중요: 프로덕션 환경에서는 반드시 모든 값을 안전하게 변경하세요!
# =====================================================================================

# =====================================================================================
# 1. 애플리케이션 기본 설정
# =====================================================================================

# 실행 프로파일 (docker | local | test)
# - docker: Docker Compose 환경에서 실행
# - local: 로컬 개발 환경에서 실행
# - test: 테스트 환경 (H2 인메모리 DB 사용)
SPRING_PROFILES_ACTIVE=docker

# 서버 포트
BACKEND_PORT=8080

# 로그 레벨 (DEBUG | INFO | WARN | ERROR)
LOG_LEVEL=INFO

# =====================================================================================
# 2. 데이터베이스 설정
# =====================================================================================

# PostgreSQL 연결 정보
DB_HOST=100.99.236.50
DB_PORT=16239
DB_NAME=mohe_db
DB_USERNAME=mohe_user
DB_PASSWORD=mohe_password

# Docker Compose용 PostgreSQL 설정 (컨테이너 내부)
POSTGRES_DB=mohe_db
POSTGRES_USER=mohe_user
POSTGRES_PASSWORD=mohe_password
POSTGRES_PORT=5432

# HikariCP 커넥션 풀 설정
DB_HIKARI_MAX_POOL_SIZE=10
DB_HIKARI_MIN_IDLE=5
DB_HIKARI_CONNECTION_TIMEOUT=30000
DB_HIKARI_IDLE_TIMEOUT=600000
DB_HIKARI_MAX_LIFETIME=1800000

# =====================================================================================
# 3. JWT 보안 설정
# =====================================================================================

# JWT 시크릿 키 (⚠️ 프로덕션에서는 반드시 64자 이상의 안전한 랜덤 문자열로 변경!)
JWT_SECRET=your-secret-key-change-in-production-minimum-64-chars-required-for-security

# JWT 토큰 만료 시간 (밀리초)
JWT_ACCESS_TOKEN_EXPIRATION=3600000      # 1시간 (3600000ms)
JWT_REFRESH_TOKEN_EXPIRATION=2592000000  # 30일 (2592000000ms)

# =====================================================================================
# 4. 외부 API 키 - 장소 데이터 수집 (필수)
# =====================================================================================

# Kakao 로컬 API (장소 검색)
# 발급: https://developers.kakao.com/
KAKAO_API_KEY=your_kakao_rest_api_key

# Naver Place Search API (장소 수집 배치에서 사용)
# 발급: https://developers.naver.com/
NAVER_CLIENT_ID=your_naver_client_id
NAVER_CLIENT_SECRET=your_naver_client_secret

# =====================================================================================
# 5. 정부 공공데이터 API (선택사항)
# =====================================================================================
# 정부 공공데이터 포털에서 발급: https://www.data.go.kr/

# 행정안전부 행정구역 코드 API
GOVT_API_KEY=

# VWorld 지도 API (좌표 변환)
VWORLD_API_KEY=

# 통계청 SGIS API (지역별 통계)
SGIS_API_KEY=

# 기상청 날씨 API (한국 좌표 전용)
# 비활성화 시 Open-Meteo API 사용 (전세계 지원, API 키 불필요)
KMA_SERVICE_KEY=

# 정부 API 서버 장애 시 폴백 모드 (Y/N)
# Y로 설정 시 하드코딩된 지역 데이터 사용
IS_GOV_SERVER_DOWN=N

# 배치 작업에서 정부 API 사용 여부 (true/false)
# true: 정부 API에서 최신 행정구역 데이터 사용 (권장)
# false: 하드코딩된 Enum 사용 (Legacy - Deprecated)
BATCH_LOCATION_USE_GOVERNMENT_API=true
BATCH_LOCATION_USE_LEGACY_ENUMS=false

# =====================================================================================
# 6. AI/ML 서비스 설정
# =====================================================================================

# 임베딩 서비스 (필수 - Kanana Nano 2.1B)
# FastAPI 서버로 한국어 텍스트 임베딩 생성
# Docker: http://embedding:2000
# Local: http://localhost:2000
EMBEDDING_SERVICE_URL=http://embedding:2000
EMBEDDING_MODEL=kanana-nano-2.1b-embedding

# OpenAI API (선택사항 - AI 설명 생성)
# 활성화 시 장소 설명과 키워드를 GPT로 생성
OPENAI_API_KEY=
OPENAI_MODEL=gpt-4.1-mini
OPENAI_ENABLED=false

# Google Gemini API (선택사항 - 이미지 생성)
GEMINI_API_KEY=
GEMINI_BASE_URL=https://generativelanguage.googleapis.com/v1beta

# =====================================================================================
# 7. 웹 크롤러 서비스 (Python)
# =====================================================================================
# 장소의 상세 정보를 웹에서 수집하는 외부 크롤러 서비스

CRAWLER_SERVER_URL=http://localhost:5000
CRAWLER_API_PATH=/api/crawl
CRAWLER_ENHANCE_WITH_GOOGLE=false

# 크롤러 타임아웃 설정 (초)
CRAWLER_RESPONSE_TIMEOUT=900     # 15분
CRAWLER_CONNECTION_TIMEOUT=120   # 2분
CRAWLER_READ_TIMEOUT=900        # 15분
CRAWLER_WRITE_TIMEOUT=180       # 3분

# =====================================================================================
# 8. 이미지 처리 서비스 (Node.js)
# =====================================================================================
# 외부 이미지 프로세서 서버 (리사이징, 최적화, 저장)

IMAGE_PROCESSOR_URL=http://100.99.236.50:5200

# 이미지 저장 모드
IMAGE_USE_REMOTE=true
IMAGE_STORAGE_PATH=/images
IMAGE_SERVER_URL=http://100.99.236.50:8080

# =====================================================================================
# 9. 이메일 설정 (SMTP)
# =====================================================================================
# OTP 인증 이메일 발송에 사용

MAIL_HOST=smtp.gmail.com
MAIL_PORT=587
MAIL_USERNAME=your_email@gmail.com
MAIL_PASSWORD=your_app_specific_password

# SMTP 고급 설정
MAIL_SMTP_AUTH=true
MAIL_SMTP_STARTTLS_ENABLE=true
MAIL_SMTP_STARTTLS_REQUIRED=true
MAIL_SMTP_SSL_TRUST=smtp.gmail.com
MAIL_DEBUG=false

# 메일 타임아웃 (밀리초)
MAIL_CONNECTION_TIMEOUT=5000
MAIL_TIMEOUT=5000
MAIL_WRITE_TIMEOUT=5000

# =====================================================================================
# 10. 배치 작업 설정
# =====================================================================================

# 배치 작업 자동 실행 설정
BATCH_AUTO_START=true
BATCH_SCHEDULING_ENABLED=true
BATCH_SCHEDULING_CRON=0 */1 * * * ?  # 매 1시간마다 실행

# 배치 처리 성능 설정
BATCH_CHUNK_SIZE=50                    # 한 번에 처리할 레코드 수
BATCH_SKIP_LIMIT=10000                 # 최대 에러 허용 건수
BATCH_MAX_CONCURRENCY=4                # 최대 동시 실행 스레드 수
BATCH_CONTINUOUS_ENABLED=true          # 연속 실행 모드

# 외부 API 호출 제한
API_PAGE_SIZE=100                      # 한 번에 가져올 레코드 수
API_MAX_PAGES=50                       # 최대 페이지 수
API_TIMEOUT=30                         # API 타임아웃 (초)

# 배치 Hibernate 설정
BATCH_JDBC_BATCH_SIZE=20               # JDBC 배치 크기
BATCH_ORDER_INSERTS=true               # INSERT 쿼리 순서 최적화
BATCH_ORDER_UPDATES=true               # UPDATE 쿼리 순서 최적화

# =====================================================================================
# 11. 추천 알고리즘 가중치 조정
# =====================================================================================
# 이 값들을 조정하여 추천 결과를 미세 조정할 수 있습니다

# 벡터 검색 설정
RECOMMENDATION_TOP_K=100                      # 검색할 상위 후보 수
RECOMMENDATION_MIN_PLACES_THRESHOLD=50        # 최소 장소 수 임계값

# 유사도 계산 가중치 (합계 1.0)
RECOMMENDATION_WEIGHT_JACCARD=0.7             # Jaccard 유사도 가중치
RECOMMENDATION_WEIGHT_COSINE=0.3              # Cosine 유사도 가중치

# MBTI 매칭 가중치
RECOMMENDATION_WEIGHT_MBTI_BOOST=0.3          # MBTI 부스트 가중치
RECOMMENDATION_WEIGHT_POPULARITY_PENALTY=0.1  # 인기도 페널티 가중치
RECOMMENDATION_WEIGHT_SAME_MBTI=2.0           # 동일 MBTI 가중치
RECOMMENDATION_WEIGHT_DIFF_MBTI=1.0           # 다른 MBTI 가중치

# 시간 감쇠 함수 (최근 방문한 장소를 선호)
RECOMMENDATION_TIME_DECAY_TAU_DAYS=30         # 시간 감쇠 상수 (일)

# 기능 플래그
RECOMMENDATION_MBTI_ENABLED=false             # MBTI 기반 추천 활성화
RECOMMENDATION_DIVERSITY_ENABLED=true         # 다양성 보장 활성화

# 위치 기반 추천 거리 설정 (미터)
RECOMMENDATION_NEAR_RADIUS=15000              # 가까운 장소 반경 (15km)
RECOMMENDATION_FAR_RADIUS=30000               # 먼 장소 반경 (30km)
RECOMMENDATION_NEAR_WEIGHT=0.7                # 가까운 장소 비율 (70%)
RECOMMENDATION_FAR_WEIGHT=0.3                 # 먼 장소 비율 (30%)

# =====================================================================================
# 12. 캐시 설정
# =====================================================================================

# 날씨 데이터 캐시 (분)
WEATHER_CACHE_DURATION=10

# 지역 데이터 캐시 (시간)
KOREAN_REGION_CACHE_DURATION=24
KOREAN_REGION_CACHE_ENABLED=true

# =====================================================================================
# 13. JPA/Hibernate 설정
# =====================================================================================

# DDL 자동 생성 (none | validate | update | create | create-drop)
# ⚠️ 프로덕션: none (Flyway 마이그레이션 사용)
JPA_DDL_AUTO=none

# SQL 로깅
JPA_SHOW_SQL=false
JPA_FORMAT_SQL=true

# Flyway 마이그레이션
FLYWAY_ENABLED=true
FLYWAY_BASELINE_ON_MIGRATE=true

# =====================================================================================
# 14. 개발/테스트 전용 설정
# =====================================================================================

# Mock 기본 좌표 (좌표 파라미터 생략 시 사용)
# 프로덕션: 비워두기 (좌표 필수)
# 개발: 테스트용 기본 좌표 설정 가능
MOCK_LATITUDE=
MOCK_LONGITUDE=

# 예시: 강남역
# MOCK_LATITUDE=37.4979
# MOCK_LONGITUDE=127.0276

# =====================================================================================
# 15. 모니터링 (선택사항)
# =====================================================================================

# Grafana 대시보드
GRAFANA_PORT=3002
GRAFANA_PASSWORD=admin

# Prometheus
PROMETHEUS_PORT=9090

# =====================================================================================
# 참고사항
# =====================================================================================
#
# 필수 환경 변수:
#   - DB_HOST, DB_PORT, DB_NAME, DB_USERNAME, DB_PASSWORD
#   - JWT_SECRET (64자 이상)
#   - KAKAO_API_KEY, NAVER_CLIENT_ID, NAVER_CLIENT_SECRET
#   - EMBEDDING_SERVICE_URL
#
# 선택적 환경 변수:
#   - 정부 API 키 (없으면 폴백 데이터 사용)
#   - OpenAI, Gemini (없으면 AI 기능 비활성화)
#   - 이메일 설정 (없으면 OTP 인증 불가)
#   - 크롤러 서비스 (없으면 기본 데이터만 사용)
#
# 환경별 설정:
#   - Docker: SPRING_PROFILES_ACTIVE=docker
#   - Local: SPRING_PROFILES_ACTIVE=local
#   - Test: SPRING_PROFILES_ACTIVE=test (자동으로 H2 DB 사용)
#
# =====================================================================================
