# Development Dockerfile with hot reload support using Spring Boot DevTools
FROM gradle:8.11.1-jdk21

# Install curl for health checks
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copy gradle wrapper
COPY gradle gradle
COPY gradlew .

# Copy gradle configuration files for dependency caching
COPY build.gradle settings.gradle ./

# Pre-download dependencies (speeds up subsequent builds)
RUN ./gradlew dependencies --no-daemon || true

# Source code will be mounted as a volume at runtime
# This allows Spring Boot DevTools to detect changes and hot reload

# Expose application port
EXPOSE 8080

# Run with bootRun for hot reload support
# DevTools will automatically restart the application when changes are detected
CMD ["./gradlew", "bootRun", "--no-daemon", \
    "-Djdk.httpclient.responseBufferSize=65536", \
    "-Djdk.httpclient.maxResponseHeaderSize=32768", \
    "-Dhttp.agent=MoheSpring/1.0", \
    "-Djava.net.useSystemProxies=false", \
    "-Dsun.net.http.allowRestrictedHeaders=true", \
    "-Dhttp.keepAlive=true", \
    "-Dhttp.maxConnections=20"]