# Development Dockerfile with hot reload support using Spring Boot DevTools
# Use Gradle 8.5 with JDK 21 to avoid wrapper compatibility issues
FROM gradle:8.5-jdk21

# Install curl for health checks
RUN apt-get update && apt-get install -y curl && rm -rf /var/lib/apt/lists/*

WORKDIR /app

# Copy gradle configuration files (no need for wrapper, use container's gradle)
COPY build.gradle settings.gradle ./

# Pre-download dependencies (speeds up subsequent builds)
RUN gradle dependencies --no-daemon || true

# Source code will be mounted as a volume at runtime
# This allows Spring Boot DevTools to detect changes and hot reload

# Expose application port
EXPOSE 8080

# Run with bootRun for hot reload support (using container's gradle, not wrapper)
# DevTools will automatically restart the application when changes are detected
CMD ["gradle", "bootRun", "--no-daemon", \
    "-Djdk.httpclient.responseBufferSize=65536", \
    "-Djdk.httpclient.maxResponseHeaderSize=32768", \
    "-Dhttp.agent=MoheSpring/1.0", \
    "-Djava.net.useSystemProxies=false", \
    "-Dsun.net.http.allowRestrictedHeaders=true", \
    "-Dhttp.keepAlive=true", \
    "-Dhttp.maxConnections=20"]